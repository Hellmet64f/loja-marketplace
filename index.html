<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loja Marketplace - Assinaturas</title>
  <!--
    P치gina inicial de um marketplace estilo Shopee/OLX
    Foco: an칰ncios de assinaturas (Netflix, HBO Max, Prime Video etc.)
    Recursos:
      - Barra de busca e filtros (categoria, pre칞o, avalia칞칚o)
      - Grid de cards de an칰ncios
      - Modal de detalhes com a칞칚o de "Simular compra"
      - Login com Facebook via OAuth
    Observa칞칚o: a l칩gica b치sica est치 em marketplace.js
  -->

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0f172a;          /* azul-ard칩sia escuro */
      --panel: #111827;       /* cinza-ard칩sia muito escuro */
      --muted: #94a3b8;       /* cinza azulado */
      --text: #e5e7eb;        /* cinza claro */
      --brand: #22c55e;       /* verde destaque */
      --brand-2: #16a34a;     /* verde escuro */
      --card: #0b1220;        /* tom para cart칫es */
      --stroke: #1f2937;      /* bordas sutis */
      --warning: #f59e0b;     /* laranja */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 1200px at 90% -10%, rgba(34,197,94,.25), transparent 40%),
                  radial-gradient(1000px 800px at 10% 120%, rgba(124,58,237,.15), transparent 50%),
                  var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: rgba(17,24,39,.75); backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--stroke);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .brand { display:flex; align-items:center; gap:10px; font-weight:700; }
    .brand-badge { width:28px; height:28px; border-radius:8px; background: linear-gradient(135deg, var(--brand), var(--brand-2)); display:grid; place-items:center; color:#052e16; font-weight:900; }
    .actions { display:flex; gap:8px; align-items:center; }
    .btn { background: var(--brand); border:none; color:#052e16; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn:hover { background: var(--brand-2); color:#031a0c; }
    .chip { background:#0b1220; border:1px solid var(--stroke); color:var(--text); padding:8px 10px; border-radius:999px; cursor:pointer; }
    .muted { color: var(--muted); }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:16px; }
    .card { background: var(--card); border:1px solid var(--stroke); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .card .thumb { height:120px; border-radius:10px; display:grid; place-items:center; background:#0f172a; font-size:40px; }
    .card .meta { display:flex; justify-content:space-between; align-items:center; }
    .price { color: #86efac; font-weight:700; }
    .rating { color: #fde68a; }
    .header-row { display:flex; justify-content:space-between; align-items:center; gap:16px; }
    .searchbar { flex:1; display:flex; gap:8px; }
    input[type="search"], select { background:#0b1220; border:1px solid var(--stroke); color:var(--text); padding:10px 12px; border-radius:10px; width:100%; }

    /* Facebook button styling */
    #fbLoginBtn { background:#1877f2; color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; display:flex; align-items:center; gap:8px; }
    #fbLoginBtn:hover { background:#166fe5; }
    #userInfo { display:none; align-items:center; gap:10px; }
    #userAvatar { width:28px; height:28px; border-radius:50%; display:none; }
  </style>

  <!-- Facebook SDK (carregado de forma ass칤ncrona) -->
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId: '1363366952176543',
        cookie: true,
        xfbml: true,
        version: 'v19.0'
      });
    };
    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/pt_BR/sdk.js';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
</head>

<body>
  <div id="facebook-jssdk" aria-hidden="true" style="display:none"></div>
  <header>
    <div class="wrap header-row">
      <div class="brand">
        <div class="brand-badge">M</div>
        Loja de Assinaturas
      </div>
      <div class="actions">
        <!-- 츼rea de usu치rio -->
        <div id="userInfo" class="muted">
          <img id="userAvatar" alt="Avatar" />
          <span>Ol치, <strong id="userName"></strong></span>
          <button id="logoutButton" class="chip" type="button">Sair</button>
        </div>
        <!-- Bot칚o de login Facebook -->
        <button id="fbLoginBtn" type="button" aria-label="Entrar com Facebook">
          <!-- pequeno 칤cone F -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M22 12.06C22 6.48 17.52 2 11.94 2 6.36 2 1.88 6.48 1.88 12.06c0 5.01 3.66 9.16 8.44 9.94v-7.03H7.9v-2.91h2.42V9.64c0-2.39 1.42-3.71 3.58-3.71 1.04 0 2.13.19 2.13.19v2.35h-1.2c-1.18 0-1.55.73-1.55 1.48v1.78h2.64l-.42 2.91H13.3V22c4.78-.78 8.44-4.93 8.44-9.94Z"/></svg>
          Entrar com Facebook
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Chips de filtros adicionais (simples) -->
    <section class="filters">
      <div class="chips" id="chips">
        <div class="chip" data-chip="entrega-imediata">Entrega imediata</div>
        <div class="chip" data-chip="4k">Suporte 4K</div>
        <div class="chip" data-chip="perfil-privado">Perfil privado</div>
        <div class="chip" data-chip="garantia">Garantia</div>
      </div>
    </section>

    <!-- Grid de an칰ncios -->
    <section id="grid" class="grid" aria-live="polite">
      <!-- Cards inseridos dinamicamente por marketplace.js -->
    </section>
  </main>

  <footer>
    <div class="wrap">Projeto de exemplo para marketplace de assinaturas. C칩digo com coment치rios explicativos.</div>
  </footer>

  <!-- Modal de detalhes do an칰ncio -->
  <dialog id="detalhesModal">
    <div class="modal-head">
      <strong id="detalhesTitulo">Assinatura</strong>
      <button class="chip" id="fecharModal" aria-label="Fechar">Fechar</button>
    </div>
    <div class="modal-body">
      <div id="detalhesThumb" class="thumb" aria-hidden="true">游꿟</div>
      <div class="muted" id="detalhesVendedor"></div>
      <div id="detalhesDescricao"></div>
      <div class="meta">
        <span class="price" id="detalhesPreco"></span>
        <span class="rating" id="detalhesAvaliacao"></span>
      </div>
      <small class="muted">Observa칞칚o: esta 칠 apenas uma simula칞칚o para fins de demonstra칞칚o.</small>
    </div>
    <div class="modal-actions">
      <button class="chip" id="btnAdicionarCarrinho">Adicionar ao carrinho</button>
      <button class="btn" id="btnSimularCompra">Simular compra</button>
    </div>
  </dialog>

  <!-- Scripts principais -->
  <script src="marketplace.js"></script>
  <script>
    // Fluxo de Login com Facebook
    const fbLoginBtn = document.getElementById('fbLoginBtn');
    const userInfoEl = document.getElementById('userInfo');
    const userNameEl = document.getElementById('userName');
    const userAvatarEl = document.getElementById('userAvatar');
    const logoutBtn = document.getElementById('logoutButton');

    function updateUIForUser(user) {
      if (user) {
        userNameEl.textContent = user.name || '';
        if (user.picture && user.picture.data && user.picture.data.url) {
          userAvatarEl.src = user.picture.data.url;
          userAvatarEl.style.display = 'block';
        } else {
          userAvatarEl.style.display = 'none';
        }
        userInfoEl.style.display = 'flex';
        fbLoginBtn.style.display = 'none';
      } else {
        userNameEl.textContent = '';
        userAvatarEl.style.display = 'none';
        userInfoEl.style.display = 'none';
        fbLoginBtn.style.display = 'inline-flex';
      }
    }

    function fetchUserProfile() {
      FB.api('/me', { fields: 'name,picture.width(64).height(64)' }, function(response) {
        if (!response || response.error) {
          console.error('Erro ao buscar perfil:', response && response.error);
          updateUIForUser(null);
          return;
        }
        updateUIForUser(response);
      });
    }

    function ensureLoginAndFetchProfile() {
      FB.getLoginStatus(function(statusResponse) {
        if (statusResponse.status === 'connected') {
          fetchUserProfile();
        } else {
          FB.login(function(loginResponse) {
            if (loginResponse.authResponse) {
              fetchUserProfile();
            } else {
              console.log('Login com Facebook cancelado.');
            }
          }, { scope: 'public_profile' });
        }
      });
    }

    fbLoginBtn?.addEventListener('click', function() {
      ensureLoginAndFetchProfile();
    });

    logoutBtn?.addEventListener('click', function() {
      FB.logout(function() {
        updateUIForUser(null);
      });
    });

    // Tenta restaurar sess칚o ao carregar a p치gina
    window.addEventListener('load', function() {
      if (typeof FB !== 'undefined') {
        FB.getLoginStatus(function(res){
          if (res.status === 'connected') fetchUserProfile();
        });
      }
    });
  </script>
</body>
</html>
